# Entity Documentation and Terminology Guide

This guide explains the terminology and capabilities of the Solakon ONE Home Assistant integration entities.

## Table of Contents
- [Power Flow Concepts](#power-flow-concepts)
- [Sensor Entities](#sensor-entities)
- [Control Entities](#control-entities)
- [Understanding Operating Modes](#understanding-operating-modes)
- [Battery Management](#battery-management)
- [Energy Flow Examples](#energy-flow-examples)

## Power Flow Concepts

### Basic Power Flow in a Solar System

Your Solakon ONE system manages power flow between four main components:

1. **Solar Panels (PV)**: Generate power from sunlight
2. **Battery**: Stores energy for later use
3. **Grid**: The utility power connection
4. **Load**: Your home's power consumption

Understanding power direction:
- **Positive (+) values** typically indicate power flowing out/discharging/exporting
- **Negative (-) values** typically indicate power flowing in/charging/importing

### Key Power Sensors Explained

#### PV Power (`sensor.solakon_one_pv_power`)
- **What it shows**: Total power being generated by all solar panels combined
- **Unit**: Watts (W)
- **Always positive**: Solar panels only generate power, never consume it
- **Example**: 3500W means your panels are currently generating 3.5kW

#### Active Power (`sensor.solakon_one_active_power`)
- **What it shows**: The actual power the inverter is producing or consuming
- **Positive values**: Inverter is generating/exporting power (to grid or load)
- **Negative values**: Inverter is consuming/importing power (from grid)
- **Example**: +2000W means exporting 2kW, -1500W means importing 1.5kW

#### Battery Power (`sensor.solakon_one_battery_combined_power`)
- **What it shows**: Current battery charge/discharge rate
- **Positive values**: Battery is discharging (supplying power)
- **Negative values**: Battery is charging (storing power)
- **Example**: +3000W means battery is discharging at 3kW, -2000W means charging at 2kW

#### Load Power (`sensor.solakon_one_load_power`)
- **What it shows**: Current power consumption of your home
- **Always positive**: Your home consumes power
- **Example**: 4500W means your home is currently using 4.5kW

## Sensor Entities

### Power Monitoring

| Entity | Description | Unit | Range |
|--------|-------------|------|-------|
| `sensor.solakon_one_pv_power` | Total solar generation | W | 0 to max PV capacity |
| `sensor.solakon_one_active_power` | Inverter output power | W | Negative (import) to Positive (export) |
| `sensor.solakon_one_reactive_power` | Reactive power for grid support | VAR | -100k to +100k |
| `sensor.solakon_one_load_power` | Home consumption | W | 0 to max |
| `sensor.solakon_one_battery_combined_power` | Battery charge/discharge | W | Negative (charging) to Positive (discharging) |

### PV String Monitoring

Each string (PV1-PV4) provides:
- **Voltage** (`sensor.solakon_one_pv1_voltage`): DC voltage from panels (typically 200-500V)
- **Current** (`sensor.solakon_one_pv1_current`): DC current (typically 0-15A)
- **Power calculation**: Voltage × Current = Power per string

### Battery Monitoring

| Entity | Description | Typical Range |
|--------|-------------|---------------|
| `sensor.solakon_one_battery_combined_soc` | State of Charge (battery level) | 0-100% |
| `sensor.solakon_one_battery_combined_voltage` | Battery pack voltage | 48V nominal (40-58V range) |
| `sensor.solakon_one_battery_combined_current` | Charge/discharge current | -200A to +200A |
| `sensor.solakon_one_battery_combined_temperature` | Battery temperature | 0-60°C |
| `sensor.solakon_one_battery_state_of_health` | Battery health indicator | 0-100% |

### Energy Statistics

| Entity | Description | Resets |
|--------|-------------|--------|
| `sensor.solakon_one_total_energy` | Lifetime generation | Never |
| `sensor.solakon_one_daily_energy` | Today's generation | Daily at midnight |

### Grid Monitoring

| Entity | Description |
|--------|-------------|
| `sensor.solakon_one_grid_voltage_r` | Phase R voltage |
| `sensor.solakon_one_grid_voltage_s` | Phase S voltage |
| `sensor.solakon_one_grid_voltage_t` | Phase T voltage |
| `sensor.solakon_one_grid_frequency` | Grid frequency (50Hz or 60Hz) |
| `sensor.solakon_one_power_factor` | Power factor (-1 to +1) |

### System Status

| Entity | Description |
|--------|-------------|
| `sensor.solakon_one_internal_temperature` | Inverter temperature |
| `sensor.solakon_one_network_status` | Communication status |

## Control Entities

### EPS Output Control (`select.solakon_one_eps_output_control`)

Controls the Emergency Power Supply / Uninterruptible Power Supply functionality.

**Options:**
- **Disable**: EPS output is off (normal grid-tied operation)
- **EPS Mode**: Emergency Power Supply - provides backup power during grid outage
- **UPS Mode**: Uninterruptible Power Supply - seamless transition during grid loss

**When to use:**
- Use **EPS Mode** if you want backup power but can tolerate a brief switching delay
- Use **UPS Mode** for critical loads that cannot tolerate any interruption
- Use **Disable** during normal operation if you don't need backup power

### Remote Control Mode (`select.solakon_one_remote_control_mode`)

Advanced control mode that overrides normal automatic operation.

**Options:**

1. **Disabled**: Normal automatic operation based on device settings
2. **INV Discharge (PV Priority)**: Prioritize using solar to discharge battery
3. **INV Charge (PV Priority)**: Prioritize using solar to charge battery
4. **Battery Discharge**: Force battery to discharge regardless of conditions
5. **Battery Charge**: Force battery to charge (may use grid if PV insufficient)
6. **Grid Discharge**: Use grid power to charge battery
7. **Grid Charge**: Charge battery from grid
8. **INV Discharge (AC First)**: Prioritize AC/grid over solar for discharge
9. **INV Charge (AC First)**: Prioritize AC/grid over solar for charge

**Typical use cases:**
- **Time-of-use optimization**: Charge battery during off-peak hours, discharge during peak
- **Storm preparation**: Fully charge battery before anticipated outage
- **Grid support**: Discharge battery during high demand periods
- **Excess solar**: Force charge if generating more solar than needed

⚠️ **Warning**: Remote control modes override normal operation. Ensure timeout is set appropriately.

### Battery SoC Controls

#### Minimum SoC Control (`number.solakon_one_minimum_soc_control`)
- **Range**: 0-100%
- **Purpose**: Prevents battery from discharging below this level
- **Typical setting**: 10-20% to protect battery health
- **Example**: Set to 20% to always keep 20% reserve

#### Maximum SoC Control (`number.solakon_one_maximum_soc_control`)
- **Range**: 0-100%
- **Purpose**: Prevents battery from charging above this level
- **Typical setting**: 95-100%
- **Example**: Set to 95% for extended battery lifespan

#### Minimum SoC OnGrid Control (`number.solakon_one_minimum_soc_ongrid_control`)
- **Range**: 0-100%
- **Purpose**: Minimum battery level when grid is available
- **Differs from regular minimum**: Only applies when grid-connected
- **Use case**: Keep higher reserve when off-grid, allow deeper discharge when on-grid

### Remote Power Controls

#### Remote Active Power Control (`number.solakon_one_remote_active_power_control`)
- **Range**: -100,000W to +100,000W
- **Negative values**: Import/charge command
- **Positive values**: Export/discharge command
- **Used with**: Remote control modes for precise power control
- **Example**: Set to +5000 to command 5kW export

#### Remote Reactive Power Control (`number.solakon_one_remote_reactive_power_control`)
- **Range**: -100,000VAR to +100,000VAR
- **Purpose**: Control reactive power for grid support
- **Advanced**: Typically not needed for residential use
- **Power factor**: Related to maintaining grid power factor

#### Remote Timeout Control (`number.solakon_one_remote_timeout_control`)
- **Range**: 0-3600 seconds
- **Purpose**: Automatic timeout for remote control commands
- **Safety feature**: Prevents indefinite remote operation if command not refreshed
- **Example**: Set to 300 seconds (5 minutes) for temporary operation

## Understanding Operating Modes

### Normal Automatic Operation (Remote Control Disabled)

In this mode, the Solakon ONE automatically:
1. **Morning**: Solar generation begins, powers home, charges battery
2. **Midday**: Excess solar charges battery or exports to grid
3. **Evening**: Battery supplements/replaces grid power for home
4. **Night**: Battery discharge continues (if enabled) or grid powers home

### Manual Control via Remote Modes

When you activate a remote control mode, you override automatic behavior:

**Example Scenario - Time of Use Optimization:**
```yaml
# Morning (off-peak): Force charge from grid
7:00 AM: Set mode to "Grid Charge", Active Power to -5000W
# Day: Normal solar operation
9:00 AM: Set mode to "Disabled"
# Evening (peak): Force battery discharge
6:00 PM: Set mode to "Battery Discharge", Active Power to +3000W
# Night (off-peak): Resume normal
10:00 PM: Set mode to "Disabled"
```

## Battery Management

### Battery State of Charge (SoC)

The SoC percentage indicates battery capacity:
- **100%**: Fully charged
- **50%**: Half charged
- **0%**: Empty (typically not allowed by minimum SoC setting)

### Battery State of Health (SoH)

The SoH percentage indicates battery condition:
- **100%**: New battery condition
- **80-90%**: Good condition (slight capacity loss)
- **70-80%**: Fair condition (noticeable capacity loss)
- **Below 70%**: Consider battery replacement

### Protecting Battery Health

To maximize battery lifespan:
1. Avoid frequent deep discharges (keep minimum SoC at 10-20%)
2. Avoid keeping battery at 100% constantly (max SoC of 90-95% is better)
3. Keep battery temperature in optimal range (15-30°C)
4. Minimize high charge/discharge rates when possible

## Energy Flow Examples

### Example 1: Sunny Day with Full Battery
```
PV Power: 6000W (solar generating)
Battery Power: 0W (full, not charging)
Active Power: 4500W (exporting to grid)
Load Power: 1500W (home consumption)

Flow: Solar (6kW) → Home (1.5kW) + Grid Export (4.5kW)
```

### Example 2: Evening, Battery Discharging
```
PV Power: 0W (no solar)
Battery Power: 3000W (discharging)
Active Power: 500W (slight export)
Load Power: 3500W (home consumption)

Flow: Battery (3kW) → Home (3.5kW), Grid supplements 0.5kW
```

### Example 3: Cloudy Day, Charging Battery
```
PV Power: 2000W (limited solar)
Battery Power: -1500W (charging)
Active Power: -500W (importing)
Load Power: 1000W (home consumption)

Flow: Solar (2kW) + Grid (0.5kW) → Home (1kW) + Battery (1.5kW)
```

## Automation Tips

### Monitor Battery and Alert on Low SoC
```yaml
automation:
  - alias: "Low Battery Alert"
    trigger:
      platform: numeric_state
      entity_id: sensor.solakon_one_battery_combined_soc
      below: 20
    action:
      service: notify.mobile_app
      data:
        message: "Battery low at {{ states('sensor.solakon_one_battery_combined_soc') }}%"
```

### Dynamic SoC Based on Weather Forecast
```yaml
automation:
  - alias: "Adjust SoC for Weather"
    trigger:
      platform: time
      at: "06:00:00"
    condition:
      condition: numeric_state
      entity_id: sensor.weather_forecast_cloud_coverage
      above: 80
    action:
      service: number.set_value
      target:
        entity_id: number.solakon_one_minimum_soc_control
      data:
        value: 30  # Keep more reserve if cloudy day expected
```

### Time-of-Use Optimization
```yaml
automation:
  - alias: "TOU - Charge During Off-Peak"
    trigger:
      platform: time
      at: "02:00:00"
    action:
      - service: select.select_option
        target:
          entity_id: select.solakon_one_remote_control_mode
        data:
          option: "Grid Charge"
      - service: number.set_value
        target:
          entity_id: number.solakon_one_remote_timeout_control
        data:
          value: 14400  # 4 hours

  - alias: "TOU - Resume Normal After Charge"
    trigger:
      platform: time
      at: "06:00:00"
    action:
      service: select.select_option
      target:
        entity_id: select.solakon_one_remote_control_mode
      data:
        option: "Disabled"
```

## Troubleshooting

### Understanding Unexpected Behavior

**Problem**: Battery not charging even with excess solar
- Check: Maximum SoC setting - battery may already be at limit
- Check: Remote control mode - may be overriding normal operation
- Check: Battery temperature - may be too hot/cold for charging

**Problem**: Battery discharging during solar production
- Check: Remote control mode settings
- Check: Load power - may exceed PV production
- Check: Minimum SoC OnGrid setting - may be preventing charge

**Problem**: No power flow to/from grid
- Check: EPS Output mode - may be in backup mode
- Check: Grid voltage sensors - grid may be disconnected
- Check: Network status - communication issue

## Getting Help

For issues, questions, or feature requests:
- Check this documentation first
- Review the main [README.md](../README.md) for setup instructions
- Search existing [GitHub Issues](https://github.com/solakon-de/solakon-one-homeassistant/issues)
- Create a new issue with:
  - Clear description of the problem
  - Relevant sensor values
  - Home Assistant logs if applicable
  - What you've already tried

## Contributing

Found an error in this documentation or want to improve it?
- Submit a pull request with corrections
- Open an issue describing what's unclear
- Share your automation examples to help others
